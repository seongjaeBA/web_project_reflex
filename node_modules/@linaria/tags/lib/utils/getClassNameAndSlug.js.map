{"version":3,"file":"getClassNameAndSlug.js","names":["_path","require","_logger","_utils","_buildSlug","_toValidCSSIdentifier","_interopRequireDefault","obj","__esModule","default","getClassNameAndSlug","displayName","idx","options","context","_context$filename","relativeFilename","root","filename","relative","slug","toValidCSSIdentifier","charAt","toLowerCase","slugify","ext","extname","slugVars","hash","title","file","name","basename","dir","dirname","split","sep","pop","className","classNameSlug","Error","buildSlug","debug"],"sources":["../../src/utils/getClassNameAndSlug.ts"],"sourcesContent":["import { basename, dirname, extname, relative, sep } from 'path';\n\nimport { debug } from '@linaria/logger';\nimport type { ClassNameSlugVars } from '@linaria/utils';\nimport { slugify } from '@linaria/utils';\n\nimport { buildSlug } from './buildSlug';\nimport toValidCSSIdentifier from './toValidCSSIdentifier';\nimport type { IFileContext, IOptions } from './types';\n\nexport default function getClassNameAndSlug(\n  displayName: string,\n  idx: number,\n  options: IOptions,\n  context: IFileContext\n): { className: string; slug: string } {\n  const relativeFilename =\n    context.root && context.filename\n      ? relative(context.root, context.filename)\n      : context.filename ?? 'unknown';\n  // Custom properties need to start with a letter, so we prefix the slug\n  // Also use append the index of the class to the filename for uniqueness in the file\n  const slug = toValidCSSIdentifier(\n    `${displayName.charAt(0).toLowerCase()}${slugify(\n      `${relativeFilename}:${idx}`\n    )}`\n  );\n\n  // Collect some useful replacement patterns from the filename\n  // Available variables for the square brackets used in `classNameSlug` options\n  const ext = extname(relativeFilename);\n  const slugVars: ClassNameSlugVars = {\n    hash: slug,\n    title: displayName,\n    file: relativeFilename,\n    ext,\n    name: basename(relativeFilename, ext),\n    dir: dirname(relativeFilename).split(sep).pop() as string,\n  };\n\n  let className = options.displayName\n    ? `${toValidCSSIdentifier(displayName!)}_${slug!}`\n    : slug!;\n\n  // The className can be defined by the user either as fn or a string\n  if (typeof options.classNameSlug === 'function') {\n    try {\n      className = toValidCSSIdentifier(\n        options.classNameSlug(slug, displayName, slugVars)\n      );\n    } catch {\n      throw new Error('classNameSlug option must return a string');\n    }\n  }\n\n  if (typeof options.classNameSlug === 'string') {\n    className = toValidCSSIdentifier(\n      buildSlug(options.classNameSlug, slugVars)\n    );\n  }\n\n  debug(\n    'template-parse:generated-meta',\n    `slug: ${slug}, displayName: ${displayName}, className: ${className}`\n  );\n\n  return { className, slug };\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AAEA,IAAAC,OAAA,GAAAD,OAAA;AAEA,IAAAE,MAAA,GAAAF,OAAA;AAEA,IAAAG,UAAA,GAAAH,OAAA;AACA,IAAAI,qBAAA,GAAAC,sBAAA,CAAAL,OAAA;AAA0D,SAAAK,uBAAAC,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAG3C,SAASG,mBAAmBA,CACzCC,WAAmB,EACnBC,GAAW,EACXC,OAAiB,EACjBC,OAAqB,EACgB;EAAA,IAAAC,iBAAA;EACrC,MAAMC,gBAAgB,GACpBF,OAAO,CAACG,IAAI,IAAIH,OAAO,CAACI,QAAQ,GAC5B,IAAAC,cAAQ,EAACL,OAAO,CAACG,IAAI,EAAEH,OAAO,CAACI,QAAQ,CAAC,IAAAH,iBAAA,GACxCD,OAAO,CAACI,QAAQ,cAAAH,iBAAA,cAAAA,iBAAA,GAAI,SAAS;EACnC;EACA;EACA,MAAMK,IAAI,GAAG,IAAAC,6BAAoB,EAC9B,GAAEV,WAAW,CAACW,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,CAAC,CAAE,GAAE,IAAAC,cAAO,EAC7C,GAAER,gBAAiB,IAAGJ,GAAI,EAC7B,CAAE,EACJ,CAAC;;EAED;EACA;EACA,MAAMa,GAAG,GAAG,IAAAC,aAAO,EAACV,gBAAgB,CAAC;EACrC,MAAMW,QAA2B,GAAG;IAClCC,IAAI,EAAER,IAAI;IACVS,KAAK,EAAElB,WAAW;IAClBmB,IAAI,EAAEd,gBAAgB;IACtBS,GAAG;IACHM,IAAI,EAAE,IAAAC,cAAQ,EAAChB,gBAAgB,EAAES,GAAG,CAAC;IACrCQ,GAAG,EAAE,IAAAC,aAAO,EAAClB,gBAAgB,CAAC,CAACmB,KAAK,CAACC,SAAG,CAAC,CAACC,GAAG,CAAC;EAChD,CAAC;EAED,IAAIC,SAAS,GAAGzB,OAAO,CAACF,WAAW,GAC9B,GAAE,IAAAU,6BAAoB,EAACV,WAAY,CAAE,IAAGS,IAAM,EAAC,GAChDA,IAAK;;EAET;EACA,IAAI,OAAOP,OAAO,CAAC0B,aAAa,KAAK,UAAU,EAAE;IAC/C,IAAI;MACFD,SAAS,GAAG,IAAAjB,6BAAoB,EAC9BR,OAAO,CAAC0B,aAAa,CAACnB,IAAI,EAAET,WAAW,EAAEgB,QAAQ,CACnD,CAAC;IACH,CAAC,CAAC,MAAM;MACN,MAAM,IAAIa,KAAK,CAAC,2CAA2C,CAAC;IAC9D;EACF;EAEA,IAAI,OAAO3B,OAAO,CAAC0B,aAAa,KAAK,QAAQ,EAAE;IAC7CD,SAAS,GAAG,IAAAjB,6BAAoB,EAC9B,IAAAoB,oBAAS,EAAC5B,OAAO,CAAC0B,aAAa,EAAEZ,QAAQ,CAC3C,CAAC;EACH;EAEA,IAAAe,aAAK,EACH,+BAA+B,EAC9B,SAAQtB,IAAK,kBAAiBT,WAAY,gBAAe2B,SAAU,EACtE,CAAC;EAED,OAAO;IAAEA,SAAS;IAAElB;EAAK,CAAC;AAC5B"}